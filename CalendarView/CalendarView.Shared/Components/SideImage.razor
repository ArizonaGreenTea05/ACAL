@using CalendarView.Services
@using CalendarView.Shared.Models
@using static CalendarView.Shared.Utils.CommonFunctions
@inject PictureService PictureService

<style>
	.side-image {
		position: relative;
		overflow: hidden;

		background-image:
		@(DifferentiatedDesign?.CustomSideImageOverlay ?? "radial-gradient(circle at center, rgba(0, 0, 0, 0.2) 40%, rgba(0, 0, 0, 0.8) 100%)"), url('@CurrentPictureUrl');
		background-blend-mode: multiply;
		background-repeat: no-repeat;
		background-position: center;
		background-size: cover;
	}

	.side-video {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		object-fit: cover;
		object-position: center;
		z-index: 0;
	}

</style>

<div class="side-image @(Class ?? string.Empty)"
	 style="padding: 0px 20px 15px 0px; display: flex; flex-direction: column; @(Style ?? string.Empty)">

	@if (IsVideo(CurrentPictureUrl))
	{
		<video class="side-video" autoplay muted loop playsinline>
			<source src="@CurrentPictureUrl" />
		</video>
	}

	<div style="margin: 0; padding: 0; z-index: 1; height: 100%; display: flex; flex-direction: column;">
		@ChildContent
	</div>
</div>


@code {
	[Parameter] public RenderFragment? ChildContent { get; set; }

	[Parameter] public string? Style { get; set; }

	[Parameter] public string? Class { get; set; }

	[Parameter] public bool ShowImage { get; set; }

	[Parameter] public DifferentiatedDesign? DifferentiatedDesign { get; set; }

	private string CurrentPictureUrl => PictureService.CurrentPictureUrl ?? string.Empty;

	protected override Task OnInitializedAsync()
	{
		PictureService.ItemHasChanged += async (_, _) =>
		{
			if (ShowImage) await InvokeAsync(StateHasChanged);
		};
		return Task.CompletedTask;
	}
}
